> 前言

**参考编号001文章配置好 es 并启动**
- 能正常访问 http://localhost:9200/ 即可
**如果对es有兴趣一定要看它的权威指南**

### 以标签为例做分析

- 相关度控制
    - 人工或者半人工来决定这篇文章的东西 到底和什么有关系。 参考依据：标题、内容、标签
> 001手动录入两条数据

```
数据采用 data.js 里的 data 随便来一条既可 我才用第一条和第二条  822972 是 acfuncId
注意！！！
注意！！！
注意！！！

content用字符串别用 原始的数组格式 

put localhost:9200/acfun/article/822972
body体
{
   "textContent": "妻子带了个小女孩来家度暑假，说是外甥女，其实是她的亲生女儿。原来，妻子之前跟别人有过一段婚姻，还生了孩子，却一直瞒着现在的丈夫……　　陆某没想到，自己的身上竟会发生电视剧中的情节，“我忍了8年，但这个坎还是迈不过去”。昨天，两人到法院协议离婚。　　今年35岁的陆某，是一家制造公司的员工。2002年，陆某经人介绍认识了比自己大2岁的林某，不到半年两人便登记结婚了。次年，儿子出生。　　2005年时，林某突然带回一个5岁的小女孩，说是自己的外甥女，放暑假了，接到家里住几天。　　整个暑假，小女孩都住在陆某家。儿子有个玩伴，更加热闹，陆某挺高兴。直到有一天，陆某晚上回来，意外听到房间里妻子与小女孩的对话，他一下惊呆了：　　“为什么以前都叫妈妈，现在要叫阿姨。我什么时候才能重新叫你妈妈呀？”林某告诉孩子，“等再长大一点。现在只能叫阿姨。”　　当天晚上，林某承认，小女孩确实是自己的女儿。在跟陆某结婚前，她离过一次婚，并有一个女儿，跟着前夫生活。母女感情终究难舍，她把女儿接过来度假。因为害怕陆某知道，撒谎说是外甥女。　　陆某气得一句话也说不出来，摔门而出。　　从此以后，家里就不平静了。丈夫脾气越来越差，妻子自知理亏，一直小心迁就着，但还是免不了发生争吵。　　陆某说，他无法原谅妻子的欺骗。“这几年，为了孩子，就忍一忍吧，但心头的结，始终解不开。”　　2012年，两人已经离过一次婚，后来在家长的劝说下复婚了。　　妻子林某不想离婚，女儿也大了，跟着前夫生活，对他们的生活并没有大的影响。但这一次，陆某态度坚决，一定要离，“自己结婚的时候是一手的，不想娶了一个二手的回来，还被骗了3年，怎么想都觉得自己很吃亏。”",
    "tags": [
        { "name": "ARTICLE_CATEGORY", "value": "综合", "scroe": 1 }, 
        { "name": "ARTICLE_TAG_NAME", "value": "杂谈", "scroe": 1 }, 
        { "name": "ARTICLE_TAG_SYS", "value": "杂谈", "scroe": 1 }, 
        { "name": "ARTICLE_TAG_USER", "value": "外甥女", "scroe": 1 },
            { "name": "ARTICLE_TAG_USER", "value": "私生女", "scroe": 1 }], 
    "title": "妻子与他人生女带回家称“外甥女” 丈夫苦忍8年"
}

put localhost:9200/acfun/article/321313
body 体
{
    "textContent":"UP上次谈恋爱实在什么时候呢？   已经记不清了 ！UP家里是做五金水暖方面的生意  去年还是自己开店  今年就跟我舅舅做了  他做的比较大  今天一位老顾客报货过来叫我们送货过去  比较晚了  本来是不想送  但是没办法  就开车给她送过去了  当我到了老板娘店里  老板娘不在  那我就尴尬了  本来想偷懒  回去打下球  现在估计打不成了  老板娘店里是卖五金兼职开棋牌室  所以长期比较热闹  我就下车走进店里  一看  打麻将  看不懂  就四处看看  这时来了个妹子  UP算眼前一亮吧  UP的沉寂已久的心又活泛起来了  UP非常注重第一眼的感觉  不知道为何？本来路上想着晚上做视频的  但是没做  又放过了你们一次  不用感谢  该来的迟早会来  今晚跟基佬打LOL  真刺激   不知道是因为有了目标心情好所以 游戏把把胜利的缘故么？祝UP好运吧   这事成了  我就不在做视频了",
   "tags": [
            { "name": "ARTICLE_CATEGORY", "value": "生活情感", "scroe": 1 }, 
            { "name": "ARTICLE_TAG_NAME", "value": "情感", "scroe": 1 },
            { "name": "ARTICLE_TAG_SYS", "value": "情感", "scroe": 1 }, 
            { "name": "ARTICLE_TAG_USER", "value": "外甥女", "scroe": 1 },
             { "name": "ARTICLE_TAG_USER", "value": "意义不明", "scroe": 1 }], 
    "title": "看上了客户的外甥女 接上来该怎么办？"
}
```

> 002查询相关度测试

- post查询 localhost:9200/acfun/article/_search
- body体
```
{
	"query":{
		"match":{
			"title":"外甥女"
		}
	}
}
```

搜索结果是

```
{
    "hits": {
        "total": 2,
        "max_score": 0.95561695,
        "hits": [
            {
                "_score": 0.95561695,
                "_source": {
                     // "...内容上面有了，请自行对应起来"
                    "title": "妻子与他人生女带回家称“外甥女” 丈夫苦忍8年"
                }
            },
            {
                "_score": 0.8630463,
                "_source": {
                    // "...内容上面有了，请自行对应起来"
                    "title": "看上了客户的外甥女 接上来该怎么办？"
                }
            }
        ]
    }
}
```

第一篇内容的分数更高

> 003如何提高权重

- 修改查询内容
- post查询 localhost:9200/acfun/article/_search
- body体
    ```
    {
    "query":{
        "function_score":{ 
        "query": { 
            "multi_match": {
            "query":"外甥女",
            "fields": [ "title", "textContent" ]
            }
        }
        }
    }
    }
    ```

搜索结果又变了

```
{
    "hits": {
        "total": 2,
        "max_score": 1.4948509,
        "hits": [
            {
                "_score": 1.4948509,
                "_source": {
                    "title": "妻子与他人生女带回家称“外甥女” 丈夫苦忍8年"
                }
            },
            {
                "_score": 0.8630463,
                "_source": {
                    "title": "看上了客户的外甥女 接上来该怎么办？"
                }
            }
        ]
    }
}
```